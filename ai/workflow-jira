#!/bin/bash

# Simple JIRA automation script
# Usage: ./worfklow-jira FL-123

set -e

# Check if JIRA ID is provided
if [ $# -ne 1 ]; then
    echo "Usage: $0 JIRA-ID"
    echo "Example: $0 FL-123"
    exit 1
fi

JIRA_ID="$1"

# Get the directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Read the prompt template and substitute the JIRA ID
PROMPT_TEMPLATE="$SCRIPT_DIR/resources/jira-analysis-prompt.txt"
if [ ! -f "$PROMPT_TEMPLATE" ]; then
    echo "Error: Prompt template not found at $PROMPT_TEMPLATE"
    exit 1
fi

PROMPT=$(sed "s/{{JIRA_ID}}/$JIRA_ID/g" "$PROMPT_TEMPLATE")

# Print the command we're about to run
CLAUDE_CMD="claude -p --verbose	--output-format stream-json"
echo "ðŸ¤– Executing: echo \"$PROMPT\" | $CLAUDE_CMD"

# Execute Claude and capture the response
echo "$PROMPT" | $CLAUDE_CMD

echo ""
echo "âœ… JIRA analysis complete for $JIRA_ID"
